<section class="content-header">
    <div>
        <label id="medicaoPressaoTitleLabel">Medição de Pressão Arterial</label>
        <label id="medicaoPressaoTitleLabel2">Realize a medição, preencha os campos com os resultados e confirme utilizando a leitura biométrica</label>
    </div>

</section>
<section class="content">
    <div class="container">

        <a class="pull-right">
            <button mat-button id="retornoCidadaoButton" class="pull-right" (click)="goToView()"><label id="retornoCidadaoButtonLabel">RETORNAR AO PERFIL DO CIDADÃO</label></button></a>
        <div class="box box-default" id="infoBox" *ngIf="cidadao$ | async">
            <div class="box-header with-border">
                <h3 class="box-title" id="labelInformacoes">Informações Pessoais</h3>
                <div class="box-tools pull-right">
                    <button class="btn btn-box-tool" data-widget="collapse" (click)="isCollapsed = !isCollapsed"><i class="fa fa-angle-down"></i></button>
                </div>
                <!-- /.box-tools -->
            </div>
            <!-- /.box-header -->
            <div class="box-body" *ngIf="isCollapsed">
                <div class="box box-default" id="infoBoxPessoal" *ngIf="cidadao$ | async">
                    <label id="pessoaisLabel">Pessoais</label>
                    <div class="row">
                        <div class="col-md-4">
                            <label id="dadoLabel">NOME</label>
                            <label id="dadoResult">{{oNossoCidadao.nome}}</label>
                            <label id="dadoLabel">CPF</label>
                            <label id="dadoResult">{{showingCpf}}</label>
                            <label id="dadoLabel">GÊNERO</label>
                            <label id="dadoResult">{{oNossoCidadao.dadosPessoais.genero}}</label>
                        </div>
                        <div class="col-md-4">
                            <label id="dadoLabel">DATA DE NASCIMENTO</label>
                            <label id="dadoResult">{{oNossoCidadao.dataNascimento}}</label>
                            <label id="dadoLabel">RG</label>
                            <label id="dadoResult">{{oNossoCidadao.rg}}</label>
                        </div>
                        <div class="col-md-4">
                            <label id="dadoLabel">TELEFONE</label>
                            <label id="dadoResult">{{showingPhone}}</label>
                            <label id="dadoLabel">E-MAIL</label>
                            <label id="dadoResult">{{oNossoCidadao.dadosPessoais.email}}</label>

                        </div>
                    </div>
                </div>
                <div class="box box-default" id="infoBoxEstaticas">

                    <label id="estaticasLabel">Endereço</label>
                    <div class="row">
                        <div class="col-md-4">
                            <label id="dadoLabel">CEP</label>
                            <label id="dadoResult">{{showingCep}}</label>
                            <label id="dadoLabel">ESTADO</label>
                            <label id="dadoResult">{{oNossoCidadao.dadosPessoais.endereco.estado}}</label>
                        </div>
                        <div class="col-md-4">
                            <label id="dadoLabel">ENDEREÇO</label>
                            <label id="dadoResult">{{oNossoCidadao.dadosPessoais.endereco.rua}}, {{oNossoCidadao.dadosPessoais.endereco.numero}}</label>
                            <label id="dadoLabel">COMPLEMENTO</label>
                            <label id="dadoResult">{{oNossoCidadao.dadosPessoais.endereco.complemento}}</label>
                        </div>
                        <div class="col-md-4">

                            <label id="dadoLabel">CIDADE</label>
                            <label id="dadoResult">{{oNossoCidadao.dadosPessoais.endereco.cidade}}</label>

                        </div>
                    </div>
                </div>
                <div class="box box-default" id="infoBoxEstaticas">

                    <label id="estaticasLabel">Estáticas</label>
                    <div class="row">
                        <div class="col-md-4">
                            <label id="dadoLabel">ALTURA</label>
                            <label id="dadoResult">{{oNossoCidadao.indicadorRiscoHAS.altura}} m</label>
                            <label id="dadoLabel">USO PRÉVIO DE ANTI-HIPERTENSIVO</label>
                            <label id="dadoResult" *ngIf="!oNossoCidadao.indicadorRiscoHAS.antiHipertensivos">Não</label>
                            <label id="dadoResult" *ngIf="oNossoCidadao.indicadorRiscoHAS.antiHipertensivos">Sim</label>

                        </div>
                        <div class="col-md-4">
                            <label id="dadoLabel">DIABETES</label>
                            <label id="dadoResult" *ngIf="oNossoCidadao.indicadorRiscoHAS.diabetico === 1">Não</label>
                            <label id="dadoResult" *ngIf="oNossoCidadao.indicadorRiscoHAS.diabetico === 2">Tipo 1</label>
                            <label id="dadoResult" *ngIf="oNossoCidadao.indicadorRiscoHAS.diabetico === 3">Tipo 2</label>
                            <label id="dadoResult" *ngIf="oNossoCidadao.indicadorRiscoHAS.diabetico === 4">Diabetes Gestante</label>

                            <label id="dadoLabel">HISTÓRICO DE AVC</label>
                            <label id="dadoResult" *ngIf="oNossoCidadao.indicadorRiscoHAS.historicoAvc">Sim</label>
                            <label id="dadoResult" *ngIf="!oNossoCidadao.indicadorRiscoHAS.historicoAvc">Não</label>

                        </div>
                        <div class="col-md-4">
                            <label id="dadoLabel">FUMANTE</label>
                            <label id="dadoResult" *ngIf="oNossoCidadao.indicadorRiscoHAS.fumante === 1">Não fumante</label>
                            <label id="dadoResult" *ngIf="oNossoCidadao.indicadorRiscoHAS.fumante === 2">Fumante</label>
                            <label id="dadoResult" *ngIf="oNossoCidadao.indicadorRiscoHAS.fumante === 3">Ex-fumante</label>

                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- The Modal -->
        <div class="modal fade" id="excluirmedicao">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title" id="titleModal">Excluir Aferição</h4>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        <label id="modalText">Tem certeza que deseja excluir este aferição?</label>
                        <button mat-button id="naobutton" data-dismiss="modal"><label id="naolabel">NÃO</label></button>
                        <button mat-button id="simbutton" (click)="removeSelectedRows()" data-dismiss="modal"><label id="simlabel">SIM</label></button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="excluirmedicaoES">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                        <h4 class="modal-title" id="titleModal">Excluir Aferição</h4>
                    </div>

                    <!-- Modal body -->
                    <div class="modal-body">
                        <label id="modalText">Tem certeza que deseja excluir este aferição?</label>
                        <button mat-button id="naobutton" data-dismiss="modal"><label id="naolabel">NÃO</label></button>
                        <button mat-button id="simbutton" (click)="removeSelectedMows()" data-dismiss="modal"><label id="simlabel">SIM</label></button>
                    </div>
                </div>
            </div>
        </div>
        <div class="box box-default" id="medicaoBox">
            <div class="box-header">
                <h3 class="box-title" id="labelInformacoes">Aferições</h3>
                <div class="box-tools pull-right">
                    <button class="btn btn-box-tool" data-widget="collapse"><i class="fa fa-angle-down"></i></button>
                </div>
            </div>
            <div class="box-body">
                <div id="passoum">
                    <div id="titlesTables">
                        <label id="numero">1</label>
                        <label id="medicaoTitleLabel">Realize a aferição do braço direito</label>
                        <button mat-icon-button id="deleteButton" data-toggle="modal" data-target="#excluirmedicao" class="float-right"><mat-icon>delete</mat-icon></button>
                    </div>
                    <div id="tabela">
                        <!-- TABELA-->
                        <table mat-table [dataSource]="dataSource" class="mat-elevation-z1">

                            <!-- Checkbox Column -->
                            <ng-container matColumnDef="select">
                                <th mat-header-cell *matHeaderCellDef>
                                    <mat-checkbox (change)="$event ? masterToggle() : null" [checked]="selection.hasValue() && isAllSelected()" [indeterminate]="selection.hasValue() && !isAllSelected()" [aria-label]="checkboxLabel()">
                                    </mat-checkbox>
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null" [checked]="selection.isSelected(row)" [aria-label]="checkboxLabel(row)">
                                    </mat-checkbox>
                                </td>
                            </ng-container>

                            <!-- sistolica Column -->
                            <ng-container matColumnDef="sistolica">
                                <th mat-header-cell *matHeaderCellDef> Pressão Sistólica </th>
                                <td mat-cell *matCellDef="let element"> <input matInput type="number" [(ngModel)]="element.sistolica" [class.errorInput]="(!direitoOK && error) || (element.diastolica > element.sistolica)" placeholder="Digite um valor"> </td>
                            </ng-container>

                            <!-- diastolica Column -->
                            <ng-container matColumnDef="diastolica">
                                <th mat-header-cell *matHeaderCellDef> Pressão diastólica </th>
                                <td mat-cell *matCellDef="let element"> <input matInput type="number" [(ngModel)]="element.diastolica" [class.errorInput]="(!direitoOK && error) || (element.diastolica > element.sistolica)" placeholder="Digite um valor">
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns;">
                            </tr>

                        </table>
                        <button id="novaAfericao" (click)="addRow()"><mat-icon id="iconplus">add</mat-icon><label id="afericaobuttonlabel">Nova aferição</label></button>
                        <label id="errorLabel" *ngIf="!direitoOK && error">A pressão diastólica deve ser inferior à sistólica</label>

                    </div>
                </div>
                <div id="passodois">
                    <div id="titlesTables">
                        <label id="numero">2</label>
                        <label id="medicaoTitleLabel">Realize a aferição do braço esquerdo</label>
                        <button mat-icon-button id="deleteButton" data-toggle="modal" data-target="#excluirmedicaoES" class="float-right"><mat-icon>delete</mat-icon></button>
                    </div>
                    <div id="tabela">
                        <!-- TABELA-->
                        <table mat-table [dataSource]="dataSourced" class="mat-elevation-z1">

                            <!-- Checkbox Column -->
                            <ng-container matColumnDef="select">
                                <th mat-header-cell *matHeaderCellDef>
                                    <mat-checkbox (change)="$event ? masterToggles() : null" [checked]="selections.hasValue() && isAllSelecteds()" [indeterminate]="selections.hasValue() && !isAllSelecteds()" [aria-label]="checkboxLabels()">
                                    </mat-checkbox>
                                </th>
                                <td mat-cell *matCellDef="let row">
                                    <mat-checkbox (click)="$event.stopPropagation()" (change)="$event ? selections.toggle(row) : null" [checked]="selections.isSelected(row)" [aria-label]="checkboxLabels(row)">
                                    </mat-checkbox>
                                </td>
                            </ng-container>

                            <!-- sistolica Column -->
                            <ng-container matColumnDef="sistolica">
                                <th mat-header-cell *matHeaderCellDef> Pressão Sistólica </th>
                                <td mat-cell *matCellDef="let element"> <input matInput type="number" [(ngModel)]="element.sistolica" placeholder="Digite um valor" [class.errorInput]="(!esquerdoOK && error) || (element.diastolica > element.sistolica)"> </td>
                            </ng-container>

                            <!-- diastolica Column -->
                            <ng-container matColumnDef="diastolica">
                                <th mat-header-cell *matHeaderCellDef> Pressão diastólica </th>
                                <td mat-cell *matCellDef="let element"> <input matInput type="number" [(ngModel)]="element.diastolica" placeholder="Digite um valor" [class.errorInput]="(!esquerdoOK && error) || (element.diastolica > element.sistolica)">
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayedColumns;">
                            </tr>
                        </table>
                        <button id="novaAfericao" (click)="addRowd()"><mat-icon id="iconplus" >add</mat-icon><label id="afericaobuttonlabel">Nova aferição</label></button>
                        <label id="errorLabel" *ngIf="!direitoOK && error">A pressão diastólica deve ser inferior à sistólica</label>
                    </div>
                </div>
                <div id="passotres">
                    <div id="titlesTables">
                        <label id="numero">3</label>
                        <label id="medicaoTitleLabel">Realize a aferição do peso</label>
                        <!-- <button mat-icon-button id="deleteButton" data-toggle="modal" data-target="#excluirmedicao" class="pull-right"><mat-icon>delete</mat-icon></button> -->
                    </div>
                    <input type="number" class="input-control" placeholder="Peso" id="pesoinput" [(ngModel)]="peso">
                    <!--(keyup)="onKey($event)"-->
                    <label id="errorLabel" *ngIf="(peso < 30 || peso > 400) && error">O campo 'Peso' deve estar entre 30 e 400 kg</label>

                </div>
                <div class="modal fade" id="adicionarMedicamento">
                    <div class="modal-dialog modal-md">
                        <div class="modal-content" style="background-color: #F2F2F2;">

                            <!-- Modal Header -->
                            <div class="modal-header">
                                <h4 class="modal-title" id="titleModal">Adicionar Medicamento</h4>
                            </div>

                            <!-- Modal body -->
                            <div class="modal-body">
                                <input matInput placeholder="Digite o nome do Medicamento" aria-label="Digite o nome do Medicamento" [matAutocomplete]="auto" [formControl]="myControl" id="pesoinput">
                                <mat-autocomplete #auto="matAutocomplete" (optionSelected)='addMedicine($event.option.value)'>
                                    <mat-option *ngFor="let medicine of filteredMedicine" [value]="medicine.Nome">
                                        <!-- <img class="example-option-img" aria-hidden [src]="state.flag" height="25"> -->
                                        <span>{{medicine.Nome}}</span> |
                                        <small>{{medicine.apresentacao}}</small>
                                    </mat-option>
                                </mat-autocomplete>
                                <div id="buttons-modal">
                                    <button data-dismiss="modal" id="naoAdicionarButton"><label id="naoAdicionarButtonLabel">CANCELAR</label></button>
                                    <button (click)="addRowm()" data-dismiss="modal" id="adicionarButton" style="margin-left: 6%"><label id="adicionarButtonLabel">ADICIONAR</label></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="passotres">
                    <div id="titlesTables">
                        <label id="numero">4</label>
                        <label id="medicaoTitleLabel" style="width: 388px;">Consulte o medicamente que o cidadão está tomando</label>
                        <!-- <button mat-icon-button id="deleteButton" data-toggle="modal" data-target="#excluirmedicao" class="pull-right"><mat-icon>delete</mat-icon></button> -->
                    </div>

                    <div id="tabela">
                        <!-- TABELA-->
                        <table mat-table [dataSource]="dataSourcem" class="mat-elevation-z1">
                            <ng-container matColumnDef="nome">
                                <th mat-header-cell *matHeaderCellDef>Nome</th>
                                <td mat-cell *matCellDef="let element">
                                    {{element.Nome}}
                                </td>
                            </ng-container>

                            <ng-container matColumnDef="apresentacao">
                                <th mat-header-cell *matHeaderCellDef>Apresentação</th>
                                <td mat-cell *matCellDef="let element">
                                    {{element.apresentacao}}
                                </td>
                            </ng-container>
                            <ng-container matColumnDef="delete">
                                <th mat-header-cell *matHeaderCellDef></th>
                                <td mat-cell *matCellDef="let element">
                                    <button mat-icon-button id="deleteButton" class="pull-right" (click)='deleteThisMedicine(element)' style="margin-top: 2%;"><mat-icon>delete</mat-icon></button>
                                </td>
                            </ng-container>
                            <tr mat-header-row *matHeaderRowDef="displayingColumns"></tr>
                            <tr mat-row *matRowDef="let row; columns: displayingColumns;">
                            </tr>
                        </table>
                        <button id="novaAfericao" style="width: 199px;" data-toggle="modal" data-target="#adicionarMedicamento"><mat-icon id="iconplus">add</mat-icon><label id="afericaobuttonlabel"  style="width: 199px; margin-left: 0.5%">Novo medicamento</label></button>
                    </div>
                    <!--(keyup)="onKey($event)"-->

                </div>
            </div>
        </div>
        <a routerLink="/medicao/sucesso">
            <button mat-button id="finalizarButton" (click)="checkMedicao()" *ngIf="peso"><label id="retornoCidadaoButtonLabel">FINALIZAR MEDIÇÃO</label></button></a>
        <!--*ngIf=peso -->
        <button mat-button id="finalizarButtonBlocked" *ngIf="!peso"><label id="retornoCidadaoButtonLabel">FINALIZAR MEDIÇÃO</label></button>
    </div>
</section>
